<html>

<head>
    <script>
        window.addEventListener('load', (event) => {
            console.log('window loaded')
            setup();
        });

        //maybe get rid of some of these globals.
        var con1;
        var canvasWidth, canvasHeight;
        var data1, data2;
        var buf, buf8, data;
        var erodeIndex = 2; // should be 1
        var growIndex = 70; // should be 100
        //TODO: only need one? - need to sort out consistent filenaming.

        function setup() {
            var image1 = document.getElementById("image1");
            var image2 = document.getElementById("image2");
            canvas1 = document.getElementById("canvas1");
            con1 = canvas1.getContext("2d");
            con1.drawImage(image2, 0, 0);
            canvasWidth = canvas1.width;
            canvasHeight = canvas1.height;



            var dosomething = document.getElementById("dosomething");
            dosomething.addEventListener('click', function (event) {
                console.log('comp')
                //set the onload to update the canvas
                image1.onload = function () {
                    console.log('ONE')
                    con1.globalCompositeOperation = "source-over"; //default
                    con1.drawImage(image1, 0, 0); // Or at whatever offset you like
                    //only change second image once we know first has been loaded and copied
                    image2.src = "./testimages/test2/grow-" + growIndex + ".png"
                    growIndex = (Math.min(99,growIndex+1))


                };
                image2.onload = function () {
                    console.log('TWO.')
                    //ok don't know if this is the right mode because my test data isn't good.
                    con1.globalCompositeOperation = "screen";
                    con1.drawImage(image2, 0, 0); // Or at whatever offset you like
                };

                //then change img src for each image.
                //need to make           sure these happen in the right order
                console.log('erodeIndex=',erodeIndex,Math.round(erodeIndex))
                image1.src = "./testimages/test2/erode-" + Math.round(erodeIndex) + ".png"
                erodeIndex = (Math.min(17,erodeIndex+0.5))

                //copy middle image over eroded image
                // con1.globalCompositeOperation = "source-over"; //default
                // con1.drawImage(image1, 0, 0);
                // con1.globalCompositeOperation = "screen"; //default
                // con1.drawImage(image2, 0, 0);

            });
        }

        function saveImg(filename) {
            var link = document.getElementById('link');
            link.setAttribute('download', filename);
            link.setAttribute('href', canvas1a.toDataURL("image/png").replace("image/png", "image/octet-stream"));
            link.click();
        }





    </script>
</head>

<body>
    <img id="image1" src="">
    <img id="image2" src="">
    <canvas id="canvas1" height="200" width="200"></canvas>
    <br />
    <button id="dosomething">do something</button><br />
    <!-- could create this in js -->
    <a id="link"></a>
</body>

</html>